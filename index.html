<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR at Current Location</title>
    <!-- A-FrameとAR.jsのスクリプトを読み込む -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- AR.jsを使用したARシーンを作成 -->
    <a-scene embedded arjs>
        <!-- カメラの設定 -->
        <a-entity camera gps-camera></a-entity>
        
        <!-- GPS情報を使用して現在位置にARコンテンツを表示する 38.7636023782383, 140.30430057895686-->
        <a-entity id="arEntity" gps-entity-place="latitude: 38.7636; longitude: 140.3043;">
            <!-- ARオブジェクト -->
            <a-box material="color: red;"></a-box>
        </a-entity>
        
        <!-- 初期位置 -->
        <script>
            var initialLatitude = 38.7636;
            var initialLongitude = 140.3043;

            // GPS情報の取得とARコンテンツの位置更新
            function updateLocation() {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // 初期位置と位置の差を計算
                    var latDiff = Math.abs(latitude - initialLatitude);
                    var lonDiff = Math.abs(longitude - initialLongitude);

                    // 差が一定の範囲内にある場合にARコンテンツを更新
                    var threshold = 0.001; // 誤差の許容範囲
                    if (latDiff <= threshold && lonDiff <= threshold) {
                        var arEntity = document.querySelector('#arEntity');
                        arEntity.setAttribute('gps-entity-place', {latitude: latitude, longitude: longitude});
                    }
                });
            }
            // 位置情報の更新間隔を設定
            setInterval(updateLocation, 1000);
        </script>
    </a-scene>
</body>
</html>
